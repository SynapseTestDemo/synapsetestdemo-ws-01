{
	"name": "01_CodeFreeTransformationOnCosmosDB",
	"properties": {
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "CosmosDbSqlApiCollection1",
						"type": "DatasetReference"
					},
					"name": "StoreData"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "StoreData_Parquet_ADLS",
						"type": "DatasetReference"
					},
					"name": "ToDataLake"
				}
			],
			"transformations": [
				{
					"name": "SelectColumns"
				},
				{
					"name": "DerivedColumns"
				}
			],
			"script": "source(output(\n\t\tincome as string,\n\t\tminoritiesRatio as string,\n\t\tlargeHH as string,\n\t\thighIncome150Ratio as string,\n\t\tmore1FullTimeEmployeeRatio as string,\n\t\tratioAge60 as string,\n\t\tsalesNearestWarehousesRatio as string,\n\t\tstoreId as string,\n\t\tsalesNearest5StoresRatio as string,\n\t\tcollegeRatio as string,\n\t\tavgDistanceNearest5Supermarkets as string,\n\t\tdistanceNearestWarehouse as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'document') ~> StoreData\nDerivedColumns select(mapColumn(\n\t\tincome,\n\t\tminoritiesRatio,\n\t\tlargeHH,\n\t\tratioAge60,\n\t\tsalesNearestWarehousesRatio,\n\t\tstoreId,\n\t\tsalesNearest5StoresRatio,\n\t\tcollegeRatio,\n\t\tavgDistanceNearest5Supermarkets,\n\t\tdistanceNearestWarehouse,\n\t\thighIncome150Ratio\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SelectColumns\nStoreData derive(income = toFloat(income),\n\t\tminoritiesRatio = toFloat(minoritiesRatio),\n\t\tlargeHH = toFloat(largeHH),\n\t\thighIncome150Ratio = toFloat(highIncome150Ratio),\n\t\tmore1FullTimeEmployeeRatio = toFloat(more1FullTimeEmployeeRatio),\n\t\tratioAge60 = toFloat(ratioAge60),\n\t\tsalesNearestWarehousesRatio = toFloat(salesNearestWarehousesRatio),\n\t\tstoreId = toInteger(storeId),\n\t\tsalesNearest5StoresRatio = toFloat(salesNearest5StoresRatio),\n\t\tcollegeRatio = toFloat(collegeRatio),\n\t\tavgDistanceNearest5Supermarkets = toFloat(avgDistanceNearest5Supermarkets),\n\t\tdistanceNearestWarehouse = toFloat(distanceNearestWarehouse)) ~> DerivedColumns\nSelectColumns sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet',\n\tpartitionFileNames:['Transformed_StoreDemographicsData.parquet'],\n\tpartitionBy('hash', 1),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> ToDataLake"
		}
	}
}